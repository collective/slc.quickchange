<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <metal:js fill-slot="javascript_head_slot">
<script type="text/javascript">
<!--

isSelected = false;

function SRtoggleSelect() {
  if (isSelected == false) {
    for (i = 0; i < document.edit_form.elements.length; i++){
      if (document.edit_form.elements[i].name=='targets:list')
          document.edit_form.elements[i].checked = true ;
    }
    isSelected = true;
    document.edit_form.SRselectButton.value = "Deselect All";
    return isSelected;
  }
  else {
    for (i = 0; i < document.edit_form.elements.length; i++) {
      if (document.edit_form.elements[i].name=='targets:list')
          document.edit_form.elements[i].checked = false ;
    }
    isSelected = false;
    document.edit_form.SRselectButton.value = "Select All";
    return isSelected;
  }
}

//-->
</script>
  </metal:js>
 <body>

   <div metal:fill-slot="main" i18n:domain="slc.quickchange"
       tal:define="errors options/state/getErrors;
       itemtype python:here.getTypeInfo().Title();
       editor python:member.getProperty('wysiwyg_editor','None');
       edit_language request/edit_language|prefLang;
       lang_name python:ltool.getNameForLanguageCode(edit_language);
       wysiwyg python:test(editor and editor!='None', editor, 'None');
       global zpt_error string:;
       text python:request.get('text', getattr(here,'EditableBody',''));">
<style>
#object-description{
    border: 1px dashed black;
    background-color: #eeeeee;
    padding: 10px;
    margin-left:50px;
    text-align: center;
    width: 500px;
    }
#report-table {
    border-collapse: collapse;
}
#report-table caption {
    magrin-bottom: 0.6em;
    font-weight: bold;
}
#report-table td,th {
    padding: 0.3em 1em;
    background: #eee;
}
#report-table th {
    background: #777;
    color: #fff;
    }
#report-table td {
    border-bottom: 1px dashed #555;
}
</style>

    <h1>
        <span tal:omit-tag="" i18n:translate="heading_search_replace">
        Search & Replace
        </span>
    </h1>

    <p i18n:translate="description_search_replace">
        Do a Search & Replace on this object or subtree:
    </p>

    <div id="object-description">
    <b><span tal:replace="here/Title"/> (<span tal:replace="python:'/'+here.absolute_url(1)"/>)</b>
    </div>

    <form name="edit_form"
         action="."
         method="post"
         enctype="multipart/form-data"
         tal:attributes="action string:${here/absolute_url}/${template/getId}" >

    <fieldset>

     <legend i18n:translate="legend_details">Details</legend>




    <label>Search for</label>
    <div tal:define="field_id string:search_text">
        <input type="text" size="40"
               tal:attributes="name field_id;
                               id field_id;
                               value python:request.get(field_id, '');">
    </div>

    <label>Replace with</label>
    <div tal:define="field_id string:replace_text">
        <input type="text" size="40"
               tal:attributes="name field_id;
                               id field_id;
                               value python:request.get(field_id, '');
               ">
    </div>
    <label>Use Regular Expression Syntax?</label>
    <div tal:define="field_id string:regexp">
        <input type="checkbox"
               tal:attributes="name field_id;
                               id field_id;
                               checked python:request.get(field_id, '');
               ">
    </div>
    <label>Recursive?</label>
    <div tal:define="field_id string:recursive">
        <input type="checkbox"
               tal:attributes="name field_id;
                               id field_id;
                               checked python:request.get(field_id, '');
               ">
    </div>


    <div class="formControls">
        <input type="hidden" name="edit_language" value="1" tal:attributes="value edit_language" />
        <input type="hidden" name="form.submitted" value="1" />
        <input class="context"
               tabindex=""
               type="submit"
               name="form.button.Search"
               value="Search"
               tal:attributes="tabindex tabindex/next;"
               i18n:attributes="value" />
    </div>





    <div tal:condition="request/logdata | nothing">

        <!--h3>Results</h3-->
        <table id="report-table" tal:define="pl request/logdata | nothing" summary="Search & Replace results report">
            <caption>
                <span tal:condition="request/recursive | nothing">recursive</span> search for: <span tal:replace="request/search_text | nothing"/><br>
            <span tal:condition="python:request.get('mode','')=='replace'">Replace with: <span tal:replace="request/replace_text | nothing"/></span>
                <!--span tal:condition="not: request/regexp | nothing">do not</span> use Regular expressions-->
            </caption>


            <tr>
                <th>&nbsp;</th>
                <th>ID</th>
                <th>Path</th>
            </tr>
            <tal:block repeat="line pl">
            <tr tal:condition="line/getStatus">
                <td>
                    <input type="checkbox" name="targets:list" tal:attributes="value string:${line/getObjpath}" />
                </td>
                <td tal:define="searchterm python:test(request.get('mode', '')=='replace', request.get('replace_text',''), request.get('search_text', ''))">
                    <a href="" tal:attributes="href string:${line/getObjpath}?searchterm=${searchterm}" tal:content="line/getObjid"></a>
                </td>
                <td>
                    <span tal:replace="line/getObjpath"/>
                </td>
            </tr>
            </tal:block>
            <tr>
                <td colspan="3">
                    <script type="text/javascript">
                    <!--
                    if (document.forms[0]) {
                      document.write('<input class="form-element" type="submit" name="SRselectButton" value="Select All" onClick="SRtoggleSelect(); return false">')
                      }
                    //-->
                    </script>
                </td>
            </tr>
        </table>
    </div>


    <div class="formControls">
        <input class="context"
               tabindex=""
               type="submit"
               name="form.button.Replace"
               value="Replace"
               tal:attributes="tabindex tabindex/next;"
               i18n:attributes="value" />
    </div>


</form>

  </div>

 </body>
</html>
