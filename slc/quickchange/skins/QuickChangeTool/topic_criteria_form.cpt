<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<head>
  <metal:ajax fill-slot="javascript_head_slot">
    <script src="/prototype.js" type="text/javascript"></script>
    <script src="/scriptaculous.js" type="text/javascript"></script>
    
    <script type="text/javascript"
            tal:attributes="src string:$portal_url/qc_javascripts.js"></script>

  </metal:ajax>  
</head>

<body>

    <div metal:fill-slot="main" i18n:domain="elevateIT">
       
        <h1 i18n:translate="heading_topic_criteria" i18n:domain="plone">
            Criteria for
            <span tal:content="here/TitleOrId" tal:omit-tag="" /> 
        </h1>
   
   <form name="edit_form"
         action="."
         method="post"
         enctype="multipart/form-data"
         tal:attributes="action string:${here/getId}/${template/getId}" >

    <fieldset tal:define="criteria here/listCriteria|nothing"
              tal:condition="criteria">

     <legend i18n:translate="legend_topic_criteria_details" i18n:domain="plone">Criteria Details</legend>
     
     <tal:criteria tal:repeat="criterion criteria">
        <tal:edit define="editform string:criterion/${criterion/getEditForm}/macros/${criterion/getEditForm};">
          <span metal:use-macro="python:path(editform)" />
        </tal:edit>
     </tal:criteria>
     
     <div class="formControls"
          tal:define="process_creation request/process_creation|nothing;">
      <input class="context"
             tabindex=""
             type="submit"
             name="form.button.Save"
             value="Save"
             tal:attributes="tabindex tabindex/next;" 
             i18n:attributes="value" />
             
      <input class="context"
             tabindex=""
             type="submit"
             name="form.button.Delete"
             value="Delete"
             tal:attributes="tabindex tabindex/next;" 
             i18n:attributes="value" />

     </div>
     
    </fieldset>
        
    <fieldset>
              
        <legend i18n:translate="legend_add_new_topic_criteria">Add New Topic Criteria</legend>
            
        <div class="field" style="float:left">
    
            <label for="field" i18n:translate="label_criteria_field_name">Field name</label>
    
            <div class="formHelp" i18n:translate="help_criteria_field_name">
                List Available Fields
            </div>      
    
            <select name="field"
                    id="field"
                    tabindex=""
                    tal:define="fields here/listAvailableFields;"
                    tal:attributes="tabindex tabindex/next;">
    
                 <option value="" tal:repeat="field fields" tal:attributes="value field" tal:content="field">Field</option>

            </select>

        </div>
    
        <div class="field" style="float:left">

            <label for="criterion_type" i18n:translate="label_criteria_type">Criteria type</label>

            <div class="formHelp" i18n:translate="help_criteria_type">
               List Criteria Types
            </div>      
    
            <select name="criterion_type"
                id="criterion_type"
                tabindex=""
                tal:define="types here/listCriteriaTypes;"
                tal:attributes="tabindex tabindex/next;">

                <option value="" tal:repeat="type types" tal:attributes="value type/name" tal:content="type/name">Type</option>

            </select>
    
        </div>
        
        <div class="formControls">

            <input class="context"
                   type="submit"
                   name="form.button.Add"
                   value="Add"
                   tabindex=""
                   tal:attributes="tabindex tabindex/next;"
                   i18n:attributes="value"
                   />
        </div>
        
    </fieldset>


    <fieldset i18n:domain="plone">

        <legend i18n:translate="">Batch size</legend>

        <div class="field"
             tal:define="list_batchsize request/list_batchsize|here/getList_batchsize|string:20">
            <label for="list_batchsize" i18n:translate="label_topic_listbatchsize">List Batch size</label>
            
            <div class="formHelp" i18n:translate="help_topic_listbatchsize">
                Help List Batch size to use
            </div>

            <input type="text"
                   name="list_batchsize"
                   value="1"
                   id="list_batchsize"
                   tal:attributes="value list_batchsize;
                   tabindex tabindex/next;"
                   />
        </div>

        <div class="formControls">

            <input class="context"
                   type="submit"
                   name="form.button.Batch"
                   value="Save"
                   tabindex=""
                   tal:attributes="tabindex tabindex/next;"
                   i18n:attributes="value"
                   />
        </div>

    </fieldset>
    
    
  <div metal:define-macro="join_results">
    <fieldset id="fieldset:join_results"
        tal:condition="python:here.aq_parent.portal_type=='Topic' or here.aq_parent.portal_type=='Topic Document' ">

        <legend i18n:translate="">Subtopic issues</legend>

      <div class="field">

        <label i18n:translate="" i18n:domain="elevateIT">Join results</label><br />

        <div class="formHelp">
            <p i18n:translate="" i18n:domain="elevateIT">
             Toggles joining of results. If you say 'yes' here, the results of this subtopic will be joined with
             the results of the parent topic. Duplicates are eliminated.<br>
             Saying 'yes' only makes sense if criteria are not inherited.

         </p>
         </div>

        <input class="noborder"
                   type="radio"
                   name="joinResults"
                   value="1"
                   id="joinResults_1"
                   tal:attributes= "checked here/getJoinResults;
                   tabindex tabindex;"
                   />
            <label for="joinResults_1" i18n:domain="plone" i18n:translate="">Yes</label> <br />

            <input class="noborder"
                   type="radio"
                   name="joinResults"
                   value=""
                   id="joinResults_0"
                   tal:attributes="checked not:here/getJoinResults;
                   tabindex tabindex;"
                   />
            <label for="joinResults_0" i18n:domain="plone" i18n:translate="" >No</label> 
            
         </div>
         
         <div class="field">
            <label i18n:translate="" i18n:domain="elevateIT">Inherit criteria</label><br />
                
            <div class="formHelp">
                <p i18n:translate="" i18n:domain="elevateIT">
                 Toggles inheriting criteria from the parent topic. If you say 'yes' here, the criteria of the subtopic's parent will be joined with the criteria of the subtopic. Thus the search of the parent is  narrowed.
             </p>
             </div>
            
         </div>
         
         
         <input class="noborder"
                   type="radio"
                   name="acquireCriteria"
                   value="1"
                   id="acquireCriteria_1"
                   tal:attributes= "checked here/getAcquireCriteria;
                   tabindex tabindex;"
                   />
            <label for="joinResults_1" i18n:domain="plone" i18n:translate="">Yes</label> <br />

            <input class="noborder"
                   type="radio"
                   name="acquireCriteria"
                   value=""
                   id="acquireCriteria_0"
                   tal:attributes="checked not:here/getAcquireCriteria;
                   tabindex tabindex;"
                   />
            <label for="joinResults_0" i18n:domain="plone" i18n:translate="" >No</label> 
         

         <div class="formControls">

            <input class="context"
                   type="submit"
                   name="form.button.Join"
                   value="Save"
                   tabindex=""
                   tal:attributes="tabindex tabindex/next;"
                   i18n:attributes="value"
                   />
       </div>
    </fieldset>
   </div>

   
   
  <div metal:define-macro="user_criteria">
    <tal:block condition="exists:here/criteriatouse">
    
    <fieldset xtal:condition="python:request.get('viewmode', '')=='advanced' or here.criteriatouse=='2'">
          
       <legend>
          <a href='javascript:return false;' onClick="SectionShow('topic-advanced-area', 'topic-advanced-arrow-up', 'topic-advanced-arrow-down');return false;"><img id="topic-advanced-arrow-down" src="/qc_arrowDown.gif"></a> 
          <a href='javascript:return false;' onClick="SectionHide('topic-advanced-area', 'topic-advanced-arrow-up', 'topic-advanced-arrow-down'); return false;"><img id="topic-advanced-arrow-up" src="/qc_arrowUp.gif"></a> 
          <span i18n:translate="legend_topic_criteria_advanced">Advanced Settings</span>
       </legend>
      
        
        <div class="formHelp" i18n:domain="plone" i18n:translate="help_qc_open_search_form">
                Click the arrow to display or hide the advanced configuration interface
        </div>
      
        <div id="topic-advanced-area" style="display: none;">
        
        

                  
            
            <div class="field"
                 tal:define="criteriatouse request/criteriatouse|here/criteriatouse|string:1">
                <label i18n:translate="label_topic_criteriatouse">Criteria to use</label>
                
    
                <input class="noborder"
                       type="radio"
                       name="criteriatouse"
                       value="1"
                       id="criteriatouse_1"
                       tal:attributes="checked python:criteriatouse=='1';
                       tabindex tabindex/next;"
                       />
                <label for="criteriatouse_1" i18n:translate="label_topic_usesimple">Criteria Set (Simple View)</label> <br/>
                
                <input class="noborder"
                       type="radio"
                       name="criteriatouse"
                       value="2"
                       id="criteriatouse_2"
                       tal:attributes="checked python:criteriatouse=='2';
                       tabindex tabindex/next;"
                       />
                
                 <label for="criteriatouse_2" i18n:translate="label_topic_useadvanced">Query (Advanced View)</label>
                 
            </div>
            
            <div class="field">
                <label for="query" i18n:translate="label_topic_query">Query</label>
                
                <div class="formHelp" i18n:translate="info_topic_query">
                    Queries can consist of several criteria. Every criterion must have its own line. The syntax is:<br/>
                    <b><i>Fieldname: Value</i></b> or <b><i>Fieldname</i> : {'query': <i>Value</i>, <i>more parameters</i> }</b>
                    Examples:
                    <dl>
                        <dt>'path': '/aa/bb'</dt>
                            <dd>Finds all objects which have '/aa' in the root. Works also with VHM.</dd>
                        <dt>'path': {'query': '/aa/bb', 'level': 1}</dt>
                            <dd>Finds all objects which have '/bb' one level down from the root.</dd>
                        <dt>'portal_type': ['Folder', 'Document']</dt>
                            <dd>Finds all objects which have Folder or Document as portal type.</dd>
                        <dt>'created': {'query': DateTime()-2, 'range': 'min'}</dt>
                            <dd>Finds all objects that have been created within the last 2 days.</dd>
                        <dt>'created': {'query': DateTime()-2, 'range': 'min'}<br/>
                            'portal_type' : 'News Article'</dt>
                            <dd>Finds all News Articles that have been created within the last 2 days.</dd>
                     </dl>
                </div>
                
                <textarea name="query:lines" 
                          id="query"
                          cols="80"
                          rows="6"
                          wrap="physical"
                          tabindex=""
                          tal:attributes="tabindex tabindex/next;"
                          tal:content="request/query | here/query | nothing"></textarea>
                   
                 <!--div class="info">
                    <span i18n:translate="label_see" i18n:domain="plone">see</span> <a href="help_topic_free_query">Advanced Searching with Records</a>
                 </div-->  
                        
             </div>
             
             <div class="formControls">
    
                <input class="context"
                       type="submit"
                       name="form.button.CriteriaToUse"
                       value="Save"
                       tabindex=""
                       tal:attributes="tabindex tabindex/next;"
                       i18n:attributes="value"
                       />
            </div>
        </div>
    </fieldset>
    </tal:block>
  </div>



    <input type="hidden" name="form.submitted" value="1" />

   </form>
    <script language="JavaScript">SectionHide('topic-advanced-area', 'topic-advanced-arrow-up', 'topic-advanced-arrow-down');
</script>

  </div>

 </body>
</html>
