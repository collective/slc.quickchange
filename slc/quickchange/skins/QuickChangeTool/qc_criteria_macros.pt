<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="plone">

<body>

   <div i18n:domain="elevateIT">
       
    <metal:criteriadefs define-macro="criteria_defs">   
        <form name="edit_form"
             tal:define="global Iterator python:modules['Products.CMFPlone'].IndexIterator;
                         global tabindex python:Iterator(pos=30000);"
             action="."
             method="post"
             enctype="multipart/form-data"
             tal:attributes="action string:${here/getId}/${template/getId}" >
             
             <input type="Button" value="Delete" onClick="handleCriteriaChange(action='form.button.Delete')">
    
        <fieldset tal:define="criteria here/listCriteria|nothing"
                  tal:condition="criteria">
    
         <legend i18n:translate="legend_topic_criteria_details" i18n:domain="plone">Criteria Details</legend>
         
         <tal:criteria tal:repeat="criterion criteria">
            <tal:edit define="editform string:criterion/${criterion/getEditForm}/macros/${criterion/getEditForm};">
              <span metal:use-macro="python:path(editform)" />
            </tal:edit>
         </tal:criteria>
         
         <div class="formControls"
              tal:define="process_creation request/process_creation|nothing;">
          <input class="context"
                 tabindex=""
                 type="submit"
                 name="form.button.Save"
                 value="Save"
                 tal:attributes="tabindex tabindex/next;" 
                 i18n:attributes="value" />
                 
          <input class="context"
                 tabindex=""
                 type="submit"
                 name="form.button.Delete"
                 value="Delete"
                 tal:attributes="tabindex tabindex/next;" 
                 i18n:attributes="value" />
    
         </div>
         
        </fieldset>
            
        <fieldset>
                  
            <legend i18n:translate="legend_add_new_topic_criteria">Add New Topic Criteria</legend>
                
            <div class="field" style="float:left">
        
                <label for="field" i18n:translate="label_criteria_field_name">Field name</label>
        
                <div class="formHelp" i18n:translate="help_criteria_field_name">
                    List Available Fields
                </div>      
        
                <select name="field"
                        id="field"
                        tabindex=""
                        tal:define="fields here/listAvailableFields;"
                        tal:attributes="tabindex tabindex/next;">
        
                     <option value="" tal:repeat="field fields" tal:attributes="value field" tal:content="field">Field</option>
    
                </select>
    
            </div>
        
            <div class="field" style="float:left">
    
                <label for="criterion_type" i18n:translate="label_criteria_type">Criteria type</label>
    
                <div class="formHelp" i18n:translate="help_criteria_type">
                   List Criteria Types
                </div>      
        
                <select name="criterion_type"
                    id="criterion_type"
                    tabindex=""
                    tal:define="types here/listCriteriaTypes;"
                    tal:attributes="tabindex tabindex/next;">
    
                    <option value="" tal:repeat="type types" tal:attributes="value type/name" tal:content="type/name">Type</option>
    
                </select>
        
            </div>
            
            <div class="formControls">
    
                <input class="context"
                       type="submit"
                       name="form.button.Add"
                       value="Add"
                       tabindex=""
                       tal:attributes="tabindex tabindex/next;"
                       i18n:attributes="value"
                       />
            </div>
            
        </fieldset>
    
    
        <fieldset i18n:domain="plone">
    
            <legend i18n:translate="">Batch size</legend>
    
            <div class="field"
                 tal:define="list_batchsize request/list_batchsize|here/getList_batchsize|string:20">
                <label for="list_batchsize" i18n:translate="label_topic_listbatchsize">List Batch size</label>
                
                <div class="formHelp" i18n:translate="help_topic_listbatchsize">
                    Help List Batch size to use
                </div>
    
                <input type="text"
                       name="list_batchsize"
                       value="1"
                       id="list_batchsize"
                       tal:attributes="value list_batchsize;
                       tabindex tabindex/next;"
                       />
            </div>
    
            <div class="formControls">
    
                <input class="context"
                       type="submit"
                       name="form.button.Batch"
                       value="Save"
                       tabindex=""
                       tal:attributes="tabindex tabindex/next;"
                       i18n:attributes="value"
                       />
            </div>
    
        </fieldset>
        
        <input type="hidden" name="form.submitted" value="1" />

        </form>        
        
    </metal:criteriadefs>

   
   
    <metal:criteria_user define-macro="criteria_user">
    
        <tal:block condition="exists:here/criteriatouse">
            <form name="edit_form"
             tal:define="global Iterator python:modules['Products.CMFPlone'].IndexIterator;
                         global tabindex python:Iterator(pos=30000);"
                 action="."
                 method="post"
                 enctype="multipart/form-data"
                 tal:attributes="action string:${here/getId}/${template/getId}" >
        
                <div>
        
                [ <a href="" tal:attributes="href string:${here/getId}/${template/getId}/?viewmode=advanced"
                     i18n:translate="link_advanced_view">Advanced View</a>
                | <a href="" tal:attributes="href string:${here/getId}/${template/getId}/?viewmode=simple"
                     i18n:translate="link_simple_view">Simple View</a> ]
                <input type="hidden" name="viewmode" tal:attributes="value request/viewmode|here/viewmode|string:simple"/>
                
                </div> 
                      
            <fieldset tal:condition="python:request.get('viewmode', '')=='advanced' or here.criteriatouse=='2'">
                  
                <legend i18n:translate="legend_topic_criteria_advanced">Advanced Settings</legend>
                
                <div class="field"
                     tal:define="criteriatouse request/criteriatouse|here/criteriatouse|string:1">
                    <label i18n:translate="label_topic_criteriatouse">Criteria to use</label>
                    
        
                    <input class="noborder"
                           type="radio"
                           name="criteriatouse"
                           value="1"
                           id="criteriatouse_1"
                           tal:attributes="checked python:criteriatouse=='1';
                           tabindex tabindex/next;"
                           />
                    <label for="criteriatouse_1" i18n:translate="label_topic_usesimple">Criteria Set (Simple View)</label> <br/>
                    
                    <input class="noborder"
                           type="radio"
                           name="criteriatouse"
                           value="2"
                           id="criteriatouse_2"
                           tal:attributes="checked python:criteriatouse=='2';
                           tabindex tabindex/next;"
                           />
                    
                     <label for="criteriatouse_2" i18n:translate="label_topic_useadvanced">Query (Advanced View)</label>
                     
                </div>
                
                <div class="field">
                    <label for="query" i18n:translate="label_topic_query">Query</label>
                    
                    <div class="formHelp" i18n:translate="info_topic_query">
                        Queries can consist of several criteria. Every criterion must have its own line. The syntax is:<br/>
                        <b><i>Fieldname: Value</i></b> or <b><i>Fieldname</i> : {'query': <i>Value</i>, <i>more parameters</i> }</b>
                        Examples:
                        <dl>
                            <dt>'path': '/aa/bb'</dt>
                                <dd>Finds all objects which have '/aa' in the root. Works also with VHM.</dd>
                            <dt>'path': {'query': '/aa/bb', 'level': 1}</dt>
                                <dd>Finds all objects which have '/bb' one level down from the root.</dd>
                            <dt>'portal_type': ['Folder', 'Document']</dt>
                                <dd>Finds all objects which have Folder or Document as portal type.</dd>
                            <dt>'created': {'query': DateTime()-2, 'range': 'min'}</dt>
                                <dd>Finds all objects that have been created within the last 2 days.</dd>
                            <dt>'created': {'query': DateTime()-2, 'range': 'min'}<br/>
                                'portal_type' : 'News Article'</dt>
                                <dd>Finds all News Articles that have been created within the last 2 days.</dd>
                         </dl>
                    </div>
                    
                    <textarea name="query:lines" 
                              id="query"
                              cols="80"
                              rows="6"
                              wrap="physical"
                              tabindex=""
                              tal:attributes="tabindex tabindex/next;"
                              tal:content="request/query | here/query | nothing"></textarea>
                       
                     <!--div class="info">
                        <span i18n:translate="label_see" i18n:domain="plone">see</span> <a href="help_topic_free_query">Advanced Searching with Records</a>
                     </div-->  
                            
                 </div>
                 
                 <div class="formControls">
        
                    <input class="context"
                           type="submit"
                           name="form.button.CriteriaToUse"
                           value="Save"
                           tabindex=""
                           tal:attributes="tabindex tabindex/next;"
                           i18n:attributes="value"
                           />
                </div>
        
            </fieldset>
            <input type="hidden" name="form.submitted" value="1" />
            </form>
        </tal:block>
        
 
    </metal:criteria_user>




  </div>

 </body>
</html>
