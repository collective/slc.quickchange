<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<div metal:fill-slot="main">
    <h1>QuickChangeTool Overview</h1>

    <p>Use Quickchange to select objects from your site and apply transformations to them.</p>
    
     <div class="formControls">
        <form style="float:left;" action="./folder_factories" method="post">
        <input type="hidden" name="type_name" value="QCJob">
           <input class="context"
                 tabindex=""
                 type="submit"
                 name="AddJob"
                 value="Add Job"
                 tal:attributes="tabindex tabindex/next;" 
                 i18n:attributes="value" />
        </form>
        <form style="padding-left: 5px; float:left;"  action="../portal_quickchangetool_selectors/manage" method="post">
           <input class="context"
                 tabindex=""
                 type="submit"
                 name="AddSelector"
                 value="Add Selector"
                 tal:attributes="tabindex tabindex/next;" 
                 i18n:attributes="value" />
        </form>
        <form style="padding-left: 5px; float:left;"  action="../portal_quickchangetool_transforms/manage" method="post">
           <input class="context"
                 tabindex=""
                 type="submit"
                 name="AddTransform"
                 value="Add Transform"
                 tal:attributes="tabindex tabindex/next;" 
                 i18n:attributes="value" />
        </form>
        <br clear="all">
      </div>
    
    
    <fieldset>    
    <h2>Current Job Profiles</h2>

        <div class="documentDescription" tal:content="structure here/Description">
            description
        </div>

        <tal:foldercontents define="folderContents python:here.getFolderListingFolderContents(contentFilter={'portal_type':'QCJob'}, suppressHiddenFiles=1)">
        <tal:listing condition="folderContents"
                     define="global getObjSize nocall:here/getObjSize;
                             global toPortalTime nocall:here/toPortalTime;">

            <dl>
            <tal:entry tal:repeat="obj folderContents">

                <dt tal:define="url python: obj.absolute_url()+test(obj.isPrincipiaFolderish,'/','');
                                icon python: obj.getIcon(1)">
                <a href="#" tal:attributes="href url">
                        <img src="" alt="" tal:attributes="src string:${utool}/${icon};alt here/title_or_id" />
                </a>

                <a href="#" tal:attributes="href url" tal:content="obj/title_or_id" /> [<i tal:content="obj/getStatus"/>]
                </dt>

                <dd>

                    <span tal:content="structure python:test(obj.Description(), obj.Description(), '&nbsp;')"> description </span>
                    <div class="discreet">
                        <b>Status: <span tal:replace="obj/getStatus">state</span></b> -
                        Affected Objects: <span tal:replace="python: len(obj.getTargets())">57</span> -
                        Created: <span tal:replace="obj/created">yesterday</span> - 
                        Modified: <span tal:replace="obj/modified">date</span> 
                        <br>
                    </div>
                </dd>
            </tal:entry>
            </dl>

        </tal:listing>
        
        <p class="discreet"
           tal:condition="not: folderContents" i18n:translate="description_no_jobs_in_folder">
         There are currently no Jobs defined.
        </p>

        </tal:foldercontents>
        
    </fieldset>    
        

    <fieldset>    
    <h2>Available Selectors</h2>

        <div class="documentDescription" tal:content="structure here/Description">
            description
        </div>

        <tal:foldercontents define="folderContents python:here.portal_quickchangetool_selectors.objectValues()">
        <tal:listing condition="folderContents"
                     define="global getObjSize nocall:here/getObjSize;
                             global toPortalTime nocall:here/toPortalTime;">

            <dl>
            <tal:entry tal:repeat="obj folderContents">

                <dt tal:define="url python: obj.absolute_url()+test(obj.isPrincipiaFolderish,'/','');
                                icon obj/icon">
                        <img src="" alt="" tal:attributes="src string:${utool}/${icon};alt here/getId" />
                <span tal:content="obj/getId" />
                </dt>

                <dd>
                    <span tal:content="structure python:test(obj.title_or_id(), obj.title_or_id(), '&nbsp;')"> description </span>
                </dd>
            </tal:entry>
            </dl>

        </tal:listing>
        
        <p class="discreet"
           tal:condition="not: folderContents" i18n:translate="description_no_selectors_in_folder">
         There are currently no selectors available.
        </p>

        </tal:foldercontents>
    </fieldset>    
        
        
    <fieldset>    
    <h2>Available Transforms</h2>

        <div class="documentDescription" tal:content="structure here/Description">
            description
        </div>

        <tal:foldercontents define="folderContents python:here.portal_quickchangetool_transforms.objectValues()">
        <tal:listing condition="folderContents"
                     define="global getObjSize nocall:here/getObjSize;
                             global toPortalTime nocall:here/toPortalTime;">

            <dl>
            <tal:entry tal:repeat="obj folderContents">

                <dt tal:define="url python: obj.absolute_url()+test(obj.isPrincipiaFolderish,'/','');
                                icon obj/icon">
                        <img src="" alt="" tal:attributes="src string:${utool}/${icon};alt here/title_or_id" />
                <span tal:content="obj/title_or_id" />
                </dt>

                <dd>

                    <span tal:content="structure python:test(obj.Description(), obj.Description(), '&nbsp;')"> description </span>
                </dd>
            </tal:entry>
            </dl>

        </tal:listing>
        
        <p class="discreet"
           tal:condition="not: folderContents" i18n:translate="description_no_transforms_in_folder">
         There are currently no transforms available.
        </p>

        </tal:foldercontents>
    </fieldset>    
    
</div>

</body>
</html>
